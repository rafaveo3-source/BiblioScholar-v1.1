<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#fafaf9">
    
    <!-- PWA Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BiblioScholar">
    <meta name="mobile-web-app-capable" content="yes">
    
    <title>BiblioScholar App</title>

    <!-- Favicon & Icons -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%2378350f%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22><rect width=%22100%25%22 height=%22100%25%22 fill=%22%23fafaf9%22 rx=%224%22/><path d=%22M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z%22/><path d=%22M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z%22/></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%2378350f%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22><rect width=%22100%25%22 height=%22100%25%22 fill=%22%23fafaf9%22 rx=%224%22/><path d=%22M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z%22/><path d=%22M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z%22/></svg>">

    <!-- Fonts & Libs -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- PWA Manifest Injection -->
    <script>
        const manifest = {
            "name": "BiblioScholar",
            "short_name": "BiblioScholar",
            "start_url": ".",
            "display": "standalone",
            "background_color": "#fafaf9",
            "theme_color": "#fafaf9",
            "icons": [{
                "src": "data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%2378350f%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22><rect width=%22100%25%22 height=%22100%25%22 fill=%22%23fafaf9%22 rx=%224%22/><path d=%22M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z%22/><path d=%22M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z%22/></svg>",
                "sizes": "192x192",
                "type": "image/svg+xml"
            }]
        };
        const link = document.createElement('link');
        link.rel = 'manifest';
        link.href = URL.createObjectURL(new Blob([JSON.stringify(manifest)], {type: 'application/json'}));
        document.head.appendChild(link);
    </script>

    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";
        window.GoogleGenerativeAI = GoogleGenerativeAI;
    </script>

    <style>
        /* Mobile Scroll Fixes */
        html, body { 
            height: 100%; 
            margin: 0; 
            padding: 0;
            background-color: #fafaf9; 
            color: #1c1917; 
            -webkit-font-smoothing: antialiased; 
            overflow: hidden; /* Prevent body scroll, handle inside #root */
        }
        
        #root { 
            height: 100%; 
            display: flex; 
            flex-direction: column; 
        }

        .font-serif { font-family: 'Playfair Display', serif; }
        
        /* Markdown */
        .markdown-body h1, .markdown-body h2 { color: #78350f; margin-top: 1em; font-family: 'Playfair Display', serif; font-weight: 700; }
        .markdown-body p { margin-bottom: 0.8em; line-height: 1.6; }
        .markdown-body strong { color: #78350f; }
        .markdown-body blockquote { border-left: 3px solid #d6d3d1; padding-left: 1em; font-style: italic; color: #57534e; background: #f5f5f4; padding: 0.5em; }
        .markdown-body a { color: #b45309; text-decoration: underline; font-weight: bold; }

        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .typing-dot { animation: typing 1.4s infinite ease-in-out both; height: 6px; width: 6px; border-radius: 50%; background-color: #a8a29e; display: inline-block; margin: 0 2px; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .has-note { text-decoration: underline; text-decoration-style: dotted; text-decoration-color: #b45309; background-color: #fffbeb; }
        
        /* Safe Area Padding */
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .pt-safe { padding-top: env(safe-area-inset-top); }

        /* Custom Scrollbar */
        .custom-scroll { 
            -webkit-overflow-scrolling: touch; /* Critical for iOS smooth scroll */
            overflow-y: auto;
        }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background-color: #d6d3d1; border-radius: 20px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        const { useState, useEffect, useRef } = React;

        const renderer = new marked.Renderer();
        const linkRenderer = renderer.link;
        renderer.link = (href, title, text) => {
            const html = linkRenderer.call(renderer, href, title, text);
            return html.replace(/^<a /, '<a target="_blank" rel="noopener noreferrer" ');
        };
        marked.setOptions({ renderer });

        const SYSTEM_PROMPT_TEMPLATE = `
**PERFIL DO ALUNO:**
- Nome: {{USERNAME}}
- N√≠vel: {{LEVEL}}
- Interesse: {{INTEREST}}
- Objetivo: {{GOAL}}

**DIRETRIZES PRINCIPAIS:**
Voc√™ √© um erudito em Estudos B√≠blicos e um Mentor Espiritual. Seu objetivo √© guiar o usu√°rio em uma jornada de descoberta profunda, utilizando o **M√©todo Indutivo** (Observa√ß√£o, Interpreta√ß√£o e Aplica√ß√£o) e a **Intelig√™ncia Hist√≥rico-Geogr√°fica**.

**SEUS 5 PAP√âIS DE ATUA√á√ÉO:**
1. **O Cronologista:** Situe sempre o texto na ordem cronol√≥gica real.
2. **O Arque√≥logo Forense:** Busque o *artefato espec√≠fico*.
3. **O Te√≥logo da Unidade (Tipologia):** Mostre o "Fio Vermelho".
4. **O Linguista Comparativo:** Compare tradu√ß√µes.
5. **O Mentor Indutivo:** Ensine a observar, marcar e questionar.

**INSTRU√á√ïES DE RECURSOS VISUAIS:**
* **[Imagens/Mapas/Artefatos]:** Gere LINKS DE BUSCA Markdown: [üîç Ver Imagem: T√≠tulo](https://www.google.com/search?tbm=isch&q=T√≠tulo+Contexto+Biblico)
* **V√≠deos:** [‚ñ∂Ô∏è Assistir V√≠deo](https://www.youtube.com/results?search_query=Tema+Biblico+PT+BR)

**FORMATO DE RESPOSTA:**
1. Manchete.
2. Palco da Hist√≥ria.
3. Mergulho no Texto.
4. Elo Tipol√≥gico.
5. Dica de Marca√ß√£o.
6. A Ponte.
7. Curadoria.
8. Pr√≥ximo Passo.
`;

        const DataManager = {
            getUsers: () => JSON.parse(localStorage.getItem('bs_users') || '{}'),
            saveUser: (username, password) => {
                const users = DataManager.getUsers();
                if (users[username]) return false;
                users[username] = { username, password, profile: null };
                localStorage.setItem('bs_users', JSON.stringify(users));
                return users[username];
            },
            login: (username, password) => {
                const users = DataManager.getUsers();
                const user = users[username];
                return (user && user.password === password) ? user : null;
            },
            updateProfile: (username, profile) => {
                const users = DataManager.getUsers();
                if (users[username]) {
                    users[username].profile = profile;
                    localStorage.setItem('bs_users', JSON.stringify(users));
                    return users[username];
                }
                return null;
            },
            getSessions: (username) => JSON.parse(localStorage.getItem(`bs_sessions_${username}`) || '[]'),
            saveSessions: (username, sessions) => localStorage.setItem(`bs_sessions_${username}`, JSON.stringify(sessions)),
            getNotes: (username) => JSON.parse(localStorage.getItem(`bs_notes_${username}`) || '[]'),
            saveNote: (username, note) => {
                const notes = DataManager.getNotes(username);
                const newNotes = [note, ...notes];
                localStorage.setItem(`bs_notes_${username}`, JSON.stringify(newNotes));
                return newNotes;
            },
            deleteNote: (username, noteId) => {
                const notes = DataManager.getNotes(username);
                const newNotes = notes.filter(n => n.id !== noteId);
                localStorage.setItem(`bs_notes_${username}`, JSON.stringify(newNotes));
                return newNotes;
            },
            saveBibleLoc: (username, bookId, chapter) => localStorage.setItem(`bs_bible_loc_${username}`, JSON.stringify({bookId, chapter})),
            getBibleLoc: (username) => JSON.parse(localStorage.getItem(`bs_bible_loc_${username}`) || '{"bookId":"GEN","chapter":1}'),
            exportData: () => {
                const data = { ...localStorage };
                const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `biblioscholar_backup_${new Date().toISOString().slice(0,10)}.json`;
                a.click();
            },
            importData: (file) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        Object.keys(data).forEach(key => {
                            if (key.startsWith('bs_')) localStorage.setItem(key, data[key]);
                        });
                        alert("Backup restaurado!");
                        window.location.reload();
                    } catch (err) { alert("Erro ao ler backup."); }
                };
                reader.readAsText(file);
            }
        };

        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => window.lucide?.createIcons(), [name]);
            return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
        };

        const Button = ({ children, onClick, variant = 'primary', className = '', disabled=false, title='' }) => {
            const base = "px-4 py-2 rounded-lg font-medium transition-all active:scale-95 flex items-center justify-center gap-2";
            const styles = {
                primary: "bg-amber-900 text-amber-50 shadow hover:bg-amber-800",
                secondary: "bg-white border border-stone-200 text-stone-700 hover:bg-stone-50",
                ghost: "text-stone-500 hover:bg-stone-100",
                danger: "bg-red-50 text-red-600 hover:bg-red-100 border border-red-200"
            };
            return <button onClick={onClick} disabled={disabled} title={title} className={`${base} ${styles[variant]} ${className} ${disabled ? 'opacity-50 cursor-not-allowed' : ''}`}>{children}</button>;
        };

        // --- SCREENS ---

        const AuthScreen = ({ onLogin }) => {
            const [isReg, setIsReg] = useState(false);
            const [user, setUser] = useState('');
            const [pass, setPass] = useState('');
            const [showPass, setShowPass] = useState(false);
            const [err, setErr] = useState('');

            const submit = (e) => {
                e.preventDefault();
                if (!user || !pass) return setErr("Preencha tudo.");
                const res = isReg ? DataManager.saveUser(user, pass) : DataManager.login(user, pass);
                if (res) onLogin(res); else setErr(isReg ? "Usu√°rio j√° existe" : "Credenciais inv√°lidas.");
            };
            return (
                <div className="h-full flex items-center justify-center p-6 bg-[#fafaf9] overflow-y-auto custom-scroll">
                    <div className="max-w-sm w-full bg-white p-8 rounded-2xl shadow-xl border border-stone-100 fade-in my-auto">
                        <div className="text-center mb-6">
                            <div className="w-12 h-12 bg-amber-900 text-white rounded-xl flex items-center justify-center mx-auto mb-2"><Icon name="feather"/></div>
                            <h1 className="text-xl font-serif font-bold text-stone-900">BiblioScholar</h1>
                        </div>
                        <form onSubmit={submit} className="space-y-4">
                            <div>
                                <input 
                                    value={user} 
                                    onChange={e=>setUser(e.target.value)} 
                                    className="w-full p-3 bg-white text-stone-900 border border-stone-200 rounded-lg focus:ring-2 focus:ring-amber-800 outline-none placeholder-stone-400 transition-colors" 
                                    placeholder="Usu√°rio" 
                                />
                            </div>
                            <div className="relative">
                                <input 
                                    type={showPass ? "text" : "password"} 
                                    value={pass} 
                                    onChange={e=>setPass(e.target.value)} 
                                    className="w-full p-3 bg-white text-stone-900 border border-stone-200 rounded-lg focus:ring-2 focus:ring-amber-800 outline-none placeholder-stone-400 pr-10 transition-colors" 
                                    placeholder="Senha" 
                                />
                                <button 
                                    type="button"
                                    onClick={() => setShowPass(!showPass)}
                                    className="absolute right-3 top-1/2 -translate-y-1/2 text-stone-400 hover:text-stone-600 p-1"
                                >
                                    <Icon name={showPass ? "eye-off" : "eye"} size={18} />
                                </button>
                            </div>
                            {err && <p className="text-red-500 text-xs">{err}</p>}
                            <Button className="w-full">{isReg ? 'Criar Conta' : 'Entrar'}</Button>
                        </form>
                        <button onClick={() => setIsReg(!isReg)} className="w-full mt-4 text-sm text-stone-500 underline">{isReg ? 'J√° tenho conta' : 'Criar conta nova'}</button>
                    </div>
                </div>
            );
        };

        const QuizScreen = ({ onComplete }) => {
            const [step, setStep] = useState(0);
            const [ans, setAns] = useState({});
            const qs = [
                { k: 'level', q: 'N√≠vel de conhecimento?', o: ['Iniciante', 'M√©dio', 'Te√≥logo'] },
                { k: 'interest', q: 'Interesse principal?', o: ['Hist√≥ria', 'Original', 'Devocional'] },
                { k: 'goal', q: 'Objetivo?', o: ['Pessoal', 'Pregar', 'Acad√™mico'] }
            ];
            return (
                <div className="h-full flex items-center justify-center p-6 bg-stone-50 overflow-y-auto custom-scroll">
                    <div className="max-w-md w-full fade-in">
                        <h2 className="text-xl font-serif font-bold mb-6 text-stone-900">{qs[step].q}</h2>
                        <div className="space-y-3">
                            {qs[step].o.map(opt => (
                                <button key={opt} onClick={() => {
                                    const n = { ...ans, [qs[step].k]: opt };
                                    setAns(n);
                                    if (step < 2) setStep(step + 1); else onComplete(n);
                                }} className="w-full p-4 bg-white border border-stone-200 rounded-xl text-left hover:border-amber-500 shadow-sm transition-colors text-stone-800">{opt}</button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // --- VIEWS ---

        const HomeView = ({ user, onNavigate }) => {
            const today = new Date().toLocaleDateString('pt-BR', { day: 'numeric', month: 'long' });
            return (
                <div className="h-full overflow-y-auto p-6 md:p-12 pb-32 custom-scroll">
                    <div className="max-w-4xl mx-auto fade-in">
                        <h1 className="text-xl md:text-3xl font-serif font-bold text-stone-900 mb-2">Ol√°, {user.username}.</h1>
                        <p className="text-stone-600 mb-8">Seu perfil: <strong>{user.profile.level}</strong>.</p>

                        <div onClick={() => onNavigate('chat')} className="bg-amber-900 text-white p-8 rounded-2xl shadow-lg mb-8 cursor-pointer hover:shadow-xl transition-all relative overflow-hidden group transform hover:-translate-y-1">
                            <div className="relative z-10">
                                <h3 className="text-xl font-serif font-bold mb-2">Iniciar Novo Estudo</h3>
                                <p className="text-amber-100">Fa√ßa uma pergunta teol√≥gica para a IA.</p>
                            </div>
                        </div>

                        <h3 className="font-serif font-bold text-stone-900 mb-4 text-lg">Trilhas Sugeridas</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                            <div onClick={() => onNavigate('chat', "Fa√ßa uma exegese detalhada dos Salmos, focando em poesia e teologia.")} className="bg-white p-6 rounded-xl border border-stone-200 hover:border-amber-500 transition-colors cursor-pointer shadow-sm">
                                <div className="flex items-center gap-3 mb-3">
                                    <div className="p-2 bg-amber-50 text-amber-900 rounded-lg"><Icon name="scroll" size={20} /></div>
                                    <h4 className="font-bold text-stone-800 text-lg">Exegese de Salmos</h4>
                                </div>
                                <p className="text-sm text-stone-500 leading-relaxed">An√°lise po√©tica e teol√≥gica dos salmos mais importantes.</p>
                            </div>
                            <div onClick={() => onNavigate('chat', "Descreva as viagens mission√°rias de Paulo com contexto geogr√°fico e hist√≥rico.")} className="bg-white p-6 rounded-xl border border-stone-200 hover:border-amber-500 transition-colors cursor-pointer shadow-sm">
                                <div className="flex items-center gap-3 mb-3">
                                    <div className="p-2 bg-amber-50 text-amber-900 rounded-lg"><Icon name="map" size={20} /></div>
                                    <h4 className="font-bold text-stone-800 text-lg">Paulo e suas Viagens</h4>
                                </div>
                                <p className="text-sm text-stone-500 leading-relaxed">Contexto geogr√°fico e hist√≥rico da expans√£o do evangelho.</p>
                            </div>
                        </div>

                        <h3 className="font-serif font-bold text-stone-900 mb-4 text-lg">Leitura Di√°ria ({today})</h3>
                        <div className="bg-stone-100 p-6 rounded-xl border border-stone-200 hover:border-amber-500 cursor-pointer transition-all flex items-center justify-between group" onClick={() => onNavigate('daily')}>
                            <div>
                                <h4 className="font-bold text-stone-800 mb-1">Devocional do Dia</h4>
                                <p className="text-sm text-stone-500">Descubra a leitura recomendada para hoje.</p>
                            </div>
                            <div className="w-10 h-10 bg-white rounded-full flex items-center justify-center text-amber-900 shadow-sm group-hover:scale-110 transition-transform">
                                <Icon name="sun" size={20} />
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const HistoryView = ({ sessions, onSelectSession, onDeleteSession }) => (
            <div className="h-full overflow-y-auto p-6 pb-32 custom-scroll">
                <div className="max-w-2xl mx-auto fade-in">
                    <h2 className="text-xl font-serif font-bold text-stone-900 mb-6">Seus Estudos</h2>
                    <div className="space-y-3">
                        {sessions.length === 0 ? <p className="text-stone-500 italic text-center py-12">Nenhum estudo encontrado.</p> : 
                            sessions.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt)).map(session => (
                                <div key={session.id} className="flex gap-3 group">
                                    <button onClick={() => onSelectSession(session)} className="flex-1 text-left bg-white p-5 rounded-xl border border-stone-200 hover:border-amber-500 shadow-sm transition-all active:scale-[0.98]">
                                        <h4 className="font-bold text-stone-800 mb-1 truncate">{session.title || 'Novo Estudo'}</h4>
                                        <p className="text-xs text-stone-400">{new Date(session.updatedAt).toLocaleDateString()} ‚Ä¢ {new Date(session.updatedAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</p>
                                    </button>
                                    <button 
                                        onClick={(e) => {
                                            e.stopPropagation(); 
                                            if(confirm("Apagar este estudo?")) onDeleteSession(session.id);
                                        }} 
                                        className="bg-white px-4 rounded-xl border border-stone-200 text-stone-400 hover:text-red-600 hover:border-red-200 transition-colors"
                                    >
                                        <Icon name="trash-2" size={20} />
                                    </button>
                                </div>
                            ))
                        }
                    </div>
                </div>
            </div>
        );

        const BibleView = ({ user, onNavigate }) => {
            const saved = DataManager.getBibleLoc(user.username);
            const [books, setBooks] = useState([]);
            const [bookId, setBookId] = useState(saved.bookId);
            const [bookName, setBookName] = useState('G√™nesis');
            const [chapter, setChapter] = useState(saved.chapter);
            const [text, setText] = useState([]);
            const [loading, setLoading] = useState(false);
            const [selVerse, setSelVerse] = useState(null);
            const [note, setNote] = useState('');
            const [userNotes, setUserNotes] = useState(DataManager.getNotes(user.username));

            useEffect(() => { setUserNotes(DataManager.getNotes(user.username)); }, []);

            useEffect(() => {
                const bks = [{id:'GEN',n:'G√™nesis'},{id:'EXO',n:'√äxodo'},{id:'LEV',n:'Lev√≠tico'},{id:'NUM',n:'N√∫meros'},{id:'DEU',n:'Deuteron√¥mio'},{id:'JOS',n:'Josu√©'},{id:'JDG',n:'Ju√≠zes'},{id:'RUT',n:'Rute'},{id:'1SA',n:'1 Samuel'},{id:'2SA',n:'2 Samuel'},{id:'PSA',n:'Salmos'},{id:'PRO',n:'Prov√©rbios'},{id:'ECC',n:'Eclesiastes'},{id:'SNG',n:'Cantares'},{id:'ISA',n:'Isa√≠as'},{id:'JER',n:'Jeremias'},{id:'LAM',n:'Lamenta√ß√µes'},{id:'EZK',n:'Ezequiel'},{id:'DAN',n:'Daniel'},{id:'HOS',n:'Oseias'},{id:'JOL',n:'Joel'},{id:'AMO',n:'Am√≥s'},{id:'OBA',n:'Obadias'},{id:'JON',n:'Jonas'},{id:'MIC',n:'Miqueias'},{id:'NAM',n:'Naum'},{id:'HAB',n:'Habacuque'},{id:'ZEP',n:'Sofonias'},{id:'HAG',n:'Ageu'},{id:'ZEC',n:'Zacarias'},{id:'MAL',n:'Malaquias'},{id:'MAT',n:'Mateus'},{id:'MRK',n:'Marcos'},{id:'LUK',n:'Lucas'},{id:'JHN',n:'Jo√£o'},{id:'ACT',n:'Atos'},{id:'ROM',n:'Romanos'},{id:'1CO',n:'1 Cor√≠ntios'},{id:'2CO',n:'2 Cor√≠ntios'},{id:'GAL',n:'G√°latas'},{id:'EPH',n:'Ef√©sios'},{id:'PHP',n:'Filipenses'},{id:'COL',n:'Colossenses'},{id:'1TH',n:'1 Tessalonicenses'},{id:'2TH',n:'2 Tessalonicenses'},{id:'1TI',n:'1 Tim√≥teo'},{id:'2TI',n:'2 Tim√≥teo'},{id:'TIT',n:'Tito'},{id:'PHM',n:'Filemom'},{id:'HEB',n:'Hebreus'},{id:'JAS',n:'Tiago'},{id:'1PE',n:'1 Pedro'},{id:'2PE',n:'2 Pedro'},{id:'1JN',n:'1 Jo√£o'},{id:'2JN',n:'2 Jo√£o'},{id:'3JN',n:'3 Jo√£o'},{id:'JUD',n:'Judas'},{id:'REV',n:'Apocalipse'}];
                setBooks(bks);
                const b = bks.find(x => x.id === bookId);
                if(b) setBookName(b.n);
                loadChapter(bookId, chapter);
            }, []);

            const loadChapter = async (bid, ch) => {
                if (!ch || isNaN(ch) || ch < 1) { setChapter(ch); return; }
                setLoading(true);
                try {
                    const res = await fetch(`https://bible-api.com/${bid}+${ch}?translation=almeida`);
                    const data = await res.json();
                    if(data.verses) {
                        setText(data.verses);
                        setBookId(bid);
                        DataManager.saveBibleLoc(user.username, bid, ch);
                    }
                    setChapter(ch);
                } catch(e) { console.error("Erro API"); }
                setLoading(false);
            };

            const saveNote = () => {
                if(!note.trim()) return;
                const newNotes = DataManager.saveNote(user.username, {
                    id: Date.now(),
                    ref: `${bookName} ${chapter}:${selVerse.verse}`,
                    text: selVerse.text,
                    note: note,
                    date: new Date().toISOString()
                });
                setUserNotes(newNotes);
                setNote('');
                setSelVerse(null);
                alert("Nota salva!");
            };

            const hasNote = (verseNum) => {
                const refCheck = `${bookName} ${chapter}:${verseNum}`;
                return userNotes.some(n => n.ref === refCheck);
            };

            return (
                <div className="flex flex-col h-full bg-white">
                    <div className="p-4 bg-white border-b flex gap-2 sticky top-0 z-10 shadow-sm items-center">
                        <select className="p-3 bg-stone-50 border border-stone-200 rounded-lg flex-1 font-serif text-stone-800 text-base" value={bookId} onChange={e=>{
                            const b = books.find(x=>x.id===e.target.value);
                            setBookName(b.n);
                            loadChapter(e.target.value, 1);
                        }}>
                            {books.map(b=><option key={b.id} value={b.id}>{b.n}</option>)}
                        </select>
                        <input type="number" className="w-20 p-3 bg-stone-50 border border-stone-200 rounded-lg text-center text-base" value={chapter} onChange={e=>loadChapter(bookId, e.target.value)}/>
                        <button onClick={()=>loadChapter(bookId, parseInt(chapter)+1)} className="p-3 bg-stone-100 hover:bg-stone-200 rounded-lg transition-colors"><Icon name="arrow-right"/></button>
                    </div>
                    {/* FIXED: Reduced font size for mobile, kept larger for desktop */}
                    <div className="flex-1 overflow-y-auto p-6 md:p-8 bg-[#fafaf9] font-serif text-base md:text-lg leading-relaxed pb-32 custom-scroll text-stone-800">
                        {loading ? <div className="text-center text-stone-400 mt-20 italic">Carregando escrituras...</div> : text.map(v => (
                            <span key={v.verse} onClick={()=>setSelVerse(v)} className={`cursor-pointer hover:bg-amber-100 rounded px-1 transition-colors inline-block ${selVerse?.verse===v.verse?'bg-amber-200':''} ${hasNote(v.verse)?'has-note':''}`}>
                                <sup className="text-xs text-stone-400 font-sans mr-1 select-none font-bold">{v.verse}</sup>{v.text} 
                            </span>
                        ))}
                    </div>
                    {selVerse && (
                        /* FIXED: Changed items-end to items-center to center the modal */
                        <div className="fixed inset-0 bg-stone-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white w-full max-w-md p-6 rounded-2xl shadow-2xl animate-slide-up border-t-4 border-amber-800">
                                <div className="flex justify-between mb-4">
                                    <h3 className="font-bold text-stone-900 text-lg font-serif">{bookName} {chapter}:{selVerse.verse}</h3>
                                    <button onClick={()=>setSelVerse(null)}><Icon name="x"/></button>
                                </div>
                                <p className="italic text-stone-600 text-sm mb-4 border-l-4 border-amber-500 pl-3 py-1 bg-stone-50 rounded-r">"{selVerse.text}"</p>
                                <textarea className="w-full p-4 border border-stone-200 bg-white text-stone-900 rounded-lg mb-4 text-base focus:ring-2 focus:ring-amber-500 outline-none placeholder-stone-400" rows="3" placeholder="Sua anota√ß√£o pessoal..." value={note} onChange={e=>setNote(e.target.value)}/>
                                <div className="flex gap-2">
                                    <Button onClick={saveNote} className="flex-1 py-3"><Icon name="save" size={18}/> Salvar</Button>
                                    <Button onClick={()=>{
                                        onNavigate('chat', `Fa√ßa exegese de ${bookName} ${chapter}:${selVerse.verse}: "${selVerse.text}"`);
                                    }} variant="secondary" className="flex-1 py-3"><Icon name="sparkles" size={18}/> Explicar</Button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const NotesView = ({ user }) => {
            const [notes, setNotes] = useState(DataManager.getNotes(user.username));
            
            useEffect(() => {
                setNotes(DataManager.getNotes(user.username));
            }, [user.username]);

            const handleDelete = (id) => {
                if(confirm("Deseja apagar esta nota?")) {
                    const updated = DataManager.deleteNote(user.username, id);
                    setNotes(updated);
                }
            };

            return (
                <div className="h-full overflow-y-auto p-6 pb-32 custom-scroll">
                    <div className="max-w-2xl mx-auto fade-in">
                        <h2 className="text-xl font-serif font-bold text-stone-900 mb-6">Caderno de Anota√ß√µes</h2>
                        {notes.length === 0 ? <p className="text-stone-400 italic text-center py-12">Nenhuma anota√ß√£o. Leia a B√≠blia para criar.</p> : 
                            <div className="space-y-4">
                                {notes.map(n => (
                                    <div key={n.id} className="bg-white p-5 rounded-xl shadow-sm border border-stone-100 hover:border-amber-300 transition-all">
                                        <div className="flex justify-between items-start mb-3">
                                            <span className="bg-amber-100 text-amber-900 text-xs font-bold px-2 py-1 rounded font-mono">{n.ref}</span>
                                            <button 
                                                onClick={() => handleDelete(n.id)} 
                                                className="text-stone-300 hover:text-red-500 p-2 -mr-2"
                                            >
                                                <Icon name="trash-2" size={18}/>
                                            </button>
                                        </div>
                                        <p className="text-stone-800 mb-3 leading-relaxed">{n.note}</p>
                                        <p className="text-xs text-stone-400 italic border-t border-stone-50 pt-2">"{n.text.substring(0,60)}..." ‚Ä¢ {new Date(n.date).toLocaleDateString()}</p>
                                    </div>
                                ))}
                            </div>
                        }
                    </div>
                </div>
            );
        };

        const SettingsView = ({ user }) => (
            <div className="h-full overflow-y-auto p-6 pb-32 custom-scroll">
                <div className="max-w-2xl mx-auto fade-in">
                    <h2 className="text-xl font-serif font-bold text-stone-900 mb-6">Ajustes</h2>
                    <div className="bg-white p-6 rounded-xl border border-stone-200 mb-6 shadow-sm">
                        <h3 className="font-bold mb-2 text-stone-800">Backup de Dados</h3>
                        <p className="text-sm text-stone-500 mb-4">Salve seus estudos e notas para usar em outro dispositivo.</p>
                        <div className="flex flex-col gap-3">
                            <Button onClick={DataManager.exportData} variant="secondary"><Icon name="download"/> Baixar Backup (JSON)</Button>
                            <div className="relative group">
                                <input type="file" className="absolute inset-0 opacity-0 cursor-pointer z-10" onChange={e=>DataManager.importData(e.target.files[0])} />
                                <Button variant="outline" className="w-full group-hover:bg-stone-50"><Icon name="upload"/> Restaurar Backup</Button>
                            </div>
                        </div>
                    </div>
                    <div className="bg-white p-6 rounded-xl border border-stone-200 shadow-sm">
                        <h3 className="font-bold mb-2 text-stone-800">Groq API Key</h3>
                        <input type="password" value={localStorage.getItem('gemini_api_key')||''} disabled className="w-full p-3 bg-stone-50 border border-stone-200 text-stone-600 rounded-lg mb-3 font-mono text-sm"/>
                        <button onClick={()=>{localStorage.removeItem('gemini_api_key'); window.location.reload();}} className="text-red-500 text-sm hover:underline font-medium p-2">Remover Chave e Sair</button>
                    </div>
                </div>
            </div>
        );

        const ChatView = ({ user, apiKey, promptInit, session, onUpdateSession }) => {
            const [msgs, setMsgs] = useState(session?.messages || []);
            const [input, setInput] = useState('');
            const [streaming, setStreaming] = useState(false);
            const abortControllerRef = useRef(null);
            const botRef = useRef(null);

            useEffect(() => {
                if (session?.messages && !streaming) setMsgs(session.messages);
            }, [session, streaming]);

            useEffect(() => {
                if (promptInit && !streaming) {
                     setInput(promptInit);
                }
            }, [promptInit]);

            useEffect(() => botRef.current?.scrollIntoView({behavior:'smooth'}), [msgs, streaming]);

            const stopGeneration = () => {
                if(abortControllerRef.current) {
                    abortControllerRef.current.abort();
                    setStreaming(false);
                    abortControllerRef.current = null;
                }
            };

            const send = async (txt = input) => {
                if (!txt.trim() || streaming) return;
                
                const userMsg = {role:'user', content:txt};
                const newMsgs = [...msgs, userMsg];
                setMsgs(newMsgs);
                setInput('');
                
                if(onUpdateSession && session) {
                    onUpdateSession({ ...session, messages: newMsgs, updatedAt: new Date().toISOString() });
                }

                setStreaming(true);
                const abortController = new AbortController();
                abortControllerRef.current = abortController;

                // GROQ IMPLEMENTATION
                try {
                    const sys = SYSTEM_PROMPT_TEMPLATE
                        .replace('{{USERNAME}}', user.username)
                        .replace('{{LEVEL}}', user.profile.level)
                        .replace('{{INTEREST}}', user.profile.interest)
                        .replace('{{GOAL}}', user.profile.goal);

                    const messagesPayload = [
                        { role: "system", content: sys },
                        ...newMsgs.map(m => ({ role: m.role === 'model' ? 'assistant' : 'user', content: m.content }))
                    ];

                    const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                        method: "POST",
                        headers: {
                            "Authorization": `Bearer ${apiKey}`,
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            model: "llama-3.3-70b-versatile",
                            messages: messagesPayload,
                            stream: true,
                            max_tokens: 8000
                        }),
                        signal: abortController.signal
                    });

                    if (!response.ok) {
                        const err = await response.json();
                        throw new Error(err.error?.message || "Erro na API Groq");
                    }

                    // SSE Reader
                    const reader = response.body.getReader();
                    const decoder = new TextDecoder("utf-8");
                    let fullText = "";
                    setMsgs(p => [...p, {role:'model', content:''}]);

                    while (true) {
                        const { done, value } = await reader.read();
                        if (done) break;
                        const chunk = decoder.decode(value);
                        const lines = chunk.split("\n");
                        
                        for (const line of lines) {
                            if (line.startsWith("data: ") && line !== "data: [DONE]") {
                                try {
                                    const json = JSON.parse(line.substring(6));
                                    const content = json.choices[0]?.delta?.content || "";
                                    fullText += content;
                                    setMsgs(prev => {
                                        const u = [...prev];
                                        u[u.length-1].content = fullText;
                                        return u;
                                    });
                                } catch (e) { }
                            }
                        }
                    }

                    if(onUpdateSession && session && !abortController.signal.aborted) {
                        onUpdateSession({
                            ...session,
                            messages: [...newMsgs, {role:'model', content: fullText}],
                            updatedAt: new Date().toISOString()
                        });
                    }

                } catch(e) {
                    if (!abortController.signal.aborted) {
                        setMsgs(p => [...p, {role:'model', content: `‚ö†Ô∏è **Erro:** ${e.message}\nVerifique sua chave Groq.`}]);
                    }
                } finally { 
                    setStreaming(false); 
                    abortControllerRef.current = null;
                }
            };

            return (
                <div className="flex flex-col h-full bg-stone-50">
                    <div className="flex-1 overflow-y-auto p-4 pb-32 custom-scroll">
                        {msgs.length===0 && <div className="text-center mt-32 text-stone-400 animate-fade-in"><Icon name="sparkles" size={48} className="mx-auto mb-2 opacity-50"/><p>Inicie sua jornada de estudo...</p></div>}
                        <div className="max-w-3xl mx-auto space-y-6">
                            {msgs.map((m,i)=>(
                                <div key={i} className={`flex ${m.role==='user'?'justify-end':'justify-start'} fade-in`}>
                                    <div className={`max-w-[90%] md:max-w-[80%] p-5 rounded-2xl shadow-sm leading-relaxed ${m.role==='user'?'bg-white text-stone-800 border-stone-100 rounded-tr-none':'bg-white border-stone-100 rounded-tl-none'}`}>
                                        {m.role==='user'?<p className="whitespace-pre-wrap">{m.content}</p>:<div className="markdown-body" dangerouslySetInnerHTML={{__html: marked.parse(m.content)}}/>}
                                    </div>
                                </div>
                            ))}
                            {streaming && (
                                <div className="flex justify-start fade-in">
                                    <div className="bg-white p-4 rounded-2xl rounded-tl-none shadow-sm border border-stone-100 flex gap-1 items-center">
                                        <div className="typing-dot"></div><div className="typing-dot"></div><div className="typing-dot"></div>
                                    </div>
                                </div>
                            )}
                            <div ref={botRef}/>
                        </div>
                    </div>
                    <div className="p-4 bg-white/80 backdrop-blur-md border-t border-stone-200 md:mb-0 mb-16 shadow-[0_-5px_20px_rgba(0,0,0,0.02)]">
                        <div className="max-w-3xl mx-auto flex gap-2 items-end">
                            <input value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>e.key==='Enter'&&send()} className="flex-1 p-4 bg-stone-50 border border-stone-200 rounded-xl focus:ring-2 focus:ring-amber-900/10 focus:border-amber-800 outline-none transition-all shadow-inner text-stone-800 placeholder-stone-400" placeholder="Digite sua pergunta teol√≥gica..."/>
                            {streaming ? (
                                <Button onClick={stopGeneration} variant="danger" title="Parar" className="h-[58px] w-[58px] rounded-xl flex items-center justify-center p-0 shadow-lg"><Icon name="square" size={20} fill="currentColor" /></Button>
                            ) : (
                                /* FIXED: Changed bg-stone-900 to bg-amber-900 to remove black background */
                                <Button onClick={()=>send()} disabled={!input.trim()} className="h-[58px] w-[58px] rounded-xl flex items-center justify-center p-0 shadow-lg bg-amber-900 hover:bg-amber-800"><Icon name="send" size={20}/></Button>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(JSON.parse(localStorage.getItem('bs_current_user')));
            const [tab, setTab] = useState('home');
            const [apiKey, setApiKey] = useState(localStorage.getItem('gemini_api_key'));
            const [tempKey, setTempKey] = useState('');
            const [chatData, setChatData] = useState(null);
            const [sessions, setSessions] = useState([]);
            const [currentSession, setCurrentSession] = useState(null);

            useEffect(() => { if(user) localStorage.setItem('bs_current_user', JSON.stringify(user)); }, [user]);
            useEffect(() => { if(user) setSessions(DataManager.getSessions(user.username)); }, [user]);

            const handleTabChange = (t) => {
                setTab(t);
                if (t === 'chat' && !currentSession) createNewSession();
            };

            const createNewSession = () => {
                setChatData(null);
                const newSess = { 
                    id: Date.now().toString(), 
                    title: 'Novo Estudo', 
                    messages: [{role:'model', content:`Ol√° ${user.username}. Vamos estudar?`}], 
                    updatedAt: new Date().toISOString() 
                };
                setSessions(prev => [newSess, ...prev]);
                setCurrentSession(newSess);
                DataManager.saveSessions(user.username, [newSess, ...sessions]);
                setTab('chat');
            };

            const loadSession = (s) => {
                setChatData(null);
                setCurrentSession(s); 
                setTab('chat');
            };

            const updateSessionInRealTime = (updatedSession) => {
               const newSessions = sessions.map(s => s.id === updatedSession.id ? updatedSession : s);
               setSessions(newSessions);
               setCurrentSession(updatedSession);
               DataManager.saveSessions(user.username, newSessions);
            };

            const deleteSession = (id) => {
                const left = sessions.filter(s=>s.id!==id);
                setSessions(left);
                DataManager.saveSessions(user.username, left);
                if(currentSession?.id===id) setCurrentSession(null);
            };

            const startDaily = () => {
                const newSess = { id: Date.now().toString(), title: 'Devocional Di√°rio', messages: [], updatedAt: new Date().toISOString() };
                setSessions([newSess, ...sessions]);
                setCurrentSession(newSess);
                DataManager.saveSessions(user.username, [newSess, ...sessions]);
                setChatData("Qual a leitura b√≠blica e devocional para hoje?");
                setTab('chat');
            };

            const startPromptChat = (prompt) => {
                const newSess = { id: Date.now().toString(), title: 'Estudo R√°pido', messages: [], updatedAt: new Date().toISOString() };
                setSessions([newSess, ...sessions]);
                setCurrentSession(newSess);
                DataManager.saveSessions(user.username, [newSess, ...sessions]);
                setChatData(prompt);
                setTab('chat');
            };

            const handleSaveKey = () => {
                localStorage.setItem('gemini_api_key', tempKey);
                setApiKey(tempKey);
            };
            
            const handleLogin = (u) => {
                setUser(u);
            };
            
            const handleLogout = () => {
                localStorage.removeItem('bs_current_user'); 
                setUser(null);
            };

            if (!user) return <AuthScreen onLogin={handleLogin} />;
            if (!user.profile) return <QuizScreen onComplete={p => {
                const updatedUser = DataManager.updateProfile(user.username, p);
                setUser(updatedUser);
            }} />;
            
            if (!apiKey) return (
                <div className="fixed inset-0 bg-stone-900/90 flex items-center justify-center p-6 backdrop-blur-sm">
                    <div className="bg-white p-8 rounded-2xl w-full max-w-sm text-center shadow-2xl border-t-4 border-amber-800 animate-fade-in">
                        <div className="w-12 h-12 bg-stone-100 rounded-full flex items-center justify-center mx-auto mb-4 text-amber-800"><Icon name="key" /></div>
                        <h2 className="font-serif font-bold text-xl mb-2 text-stone-900">Chave de Acesso (Groq)</h2>
                        <p className="text-sm text-stone-500 mb-6 leading-relaxed">Para conectar a IA (Llama 3), cole sua chave da Groq abaixo.</p>
                        <input className="w-full p-4 border border-stone-200 bg-white text-stone-900 rounded-xl mb-4 focus:ring-2 focus:ring-amber-800 outline-none transition-all font-mono text-sm placeholder-stone-400" type="password" placeholder="Cole aqui (gsk_...)" onChange={e => setTempKey(e.target.value)} />
                        <Button className="w-full py-4 text-lg shadow-xl" onClick={handleSaveKey}>Conectar</Button>
                        <a href="https://console.groq.com/keys" target="_blank" className="text-xs text-amber-800 mt-6 block hover:underline font-medium">Obter chave gr√°tis (Groq)</a>
                    </div>
                </div>
            );

            return (
                <div className="flex h-screen bg-[#fafaf9] overflow-hidden">
                    {/* Header Mobile */}
                    <header className="md:hidden h-16 bg-white border-b border-stone-200 flex items-center justify-between px-4 fixed top-0 left-0 right-0 z-40">
                         <div className="flex items-center gap-2">
                             <div className="w-8 h-8 bg-amber-900 text-white rounded-lg flex items-center justify-center"><Icon name="feather" size={16}/></div>
                             <span className="font-serif font-bold text-lg text-stone-900">BiblioScholar</span>
                         </div>
                         <button onClick={handleLogout} className="text-stone-400 hover:text-red-500 p-2"><Icon name="log-out" size={20}/></button>
                    </header>

                    {/* Sidebar Desktop */}
                    <aside className="hidden md:flex w-72 bg-white border-r border-stone-200 flex-col shadow-[4px_0_24px_rgba(0,0,0,0.02)] z-10">
                        <div className="p-8 border-b border-stone-100 flex items-center gap-3">
                            <div className="w-8 h-8 bg-amber-900 text-white rounded-lg flex items-center justify-center shadow-md"><Icon name="feather" size={16} /></div>
                            <span className="font-serif font-bold text-xl text-stone-900 tracking-tight">BiblioScholar</span>
                        </div>
                        <nav className="p-4 space-y-1.5 flex-1 overflow-y-auto custom-scroll">
                            {[
                                {id:'home', l:'Painel', i:'layout-dashboard'},
                                {id:'bible', l:'B√≠blia', i:'book'},
                                {id:'chat', l:'Novo Estudo', i:'message-square-plus'},
                                {id:'history', l:'Hist√≥rico', i:'history'},
                                {id:'notes', l:'Anota√ß√µes', i:'notebook-pen'},
                                {id:'settings', l:'Ajustes', i:'settings'}
                            ].map(i => (
                                /* FIXED: Changed bg-stone-900 to bg-amber-100 text-amber-900 for active state */
                                <button key={i.id} onClick={()=>i.id==='chat'?createNewSession():setTab(i.id)} className={`w-full flex gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all ${tab===i.id?'bg-amber-100 text-amber-900 shadow-md':'text-stone-600 hover:bg-stone-50 hover:text-stone-900'}`}>
                                    <Icon name={i.i} size={18}/> {i.l}
                                </button>
                            ))}
                        </nav>
                        <div className="p-4 border-t border-stone-100 bg-stone-50/50">
                            <div className="flex items-center gap-3 px-2 mb-3">
                                <div className="w-8 h-8 rounded-full bg-stone-200 flex items-center justify-center text-stone-600 font-bold text-xs shadow-inner">{user.username[0].toUpperCase()}</div>
                                <div className="overflow-hidden">
                                    <p className="text-sm font-bold text-stone-900 truncate">{user.username}</p>
                                    <p className="text-[10px] text-stone-500 truncate uppercase tracking-wider">{user.profile.level}</p>
                                </div>
                            </div>
                            <button onClick={handleLogout} className="w-full flex items-center gap-2 px-2 py-2 text-xs text-stone-400 hover:text-red-600 transition-colors rounded-lg hover:bg-red-50">
                                <Icon name="log-out" size={14}/> Encerrar Sess√£o
                            </button>
                        </div>
                    </aside>

                    <main className="flex-1 h-full relative overflow-hidden bg-stone-50 pt-16 md:pt-0">
                        {tab === 'home' && <HomeView user={user} onNavigate={(target, data) => target==='daily'?startDaily():startPromptChat(data || '')} />}
                        {tab === 'bible' && <BibleView user={user} onNavigate={(t,d) => startPromptChat(d)} />}
                        
                        {tab === 'chat' && currentSession && 
                            <ChatView 
                                key={currentSession.id}
                                user={user} 
                                apiKey={apiKey} 
                                promptInit={chatData} 
                                session={currentSession} 
                                onUpdateSession={updateSessionInRealTime} 
                            />}
                        {tab === 'history' && <HistoryView sessions={sessions} onSelectSession={loadSession} onDeleteSession={deleteSession} />}
                        {tab === 'notes' && <NotesView user={user} />}
                        {tab === 'settings' && <SettingsView user={user} />}
                    </main>

                    <nav className="md:hidden fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-lg border-t border-stone-200 flex justify-around p-2 pb-safe z-50 shadow-[0_-4px_20px_rgba(0,0,0,0.05)]">
                        {[
                            {id:'home', i:'layout-dashboard', l:'Home'},
                            {id:'bible', i:'book', l:'B√≠blia'},
                            {id:'chat', i:'message-square-plus', l:'Novo'},
                            {id:'history', i:'history', l:'Hist.'},
                            {id:'notes', i:'notebook-pen', l:'Notas'},
                            {id:'settings', i:'settings', l:'Ajustes'}
                        ].map(i => (
                            /* FIXED: Reduced icon size to 20 and padding to p-1 for native mobile look */
                            <button key={i.id} onClick={()=>i.id==='chat'?createNewSession():setTab(i.id)} className={`flex flex-col items-center p-1 rounded-xl transition-all ${tab===i.id?'text-amber-900 bg-amber-50':'text-stone-400 active:scale-95'}`}>
                                <Icon name={i.i} size={20}/>
                                <span className="text-[10px] mt-1 font-medium">{i.l}</span>
                            </button>
                        ))}
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
